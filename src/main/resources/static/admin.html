<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1, h2 { color: #333; }
        #list div {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .active-status { font-weight: bold; margin-left: 10px; }
        .active-true { color: green; }
        .active-false { color: red; }
        button { margin-left: 5px; padding: 5px 10px; cursor: pointer; }
        input { padding: 8px; margin-right: 10px; }
    </style>
</head>

<body>
<h1>Admin Panel: Şanslı Masa Yönetimi</h1>

<h2>Masa Ekle</h2>
<input id="num" placeholder="Masa numarası" type="number">
<button onclick="addTable()">Ekle</button>

<hr>

<h2>Masalar (Aktif/Pasif Ayarı)</h2>
<div id="list"></div>

<script>
    // AJAX işlemlerini daha okunur hale getirmek için async/await kullanıyoruz
    async function load() {
        const response = await fetch("/admin/tables");
        const data = await response.json();

        let html = "";
        data.forEach(t => {
            const statusClass = t.active ? "active-true" : "active-false";
            const statusText = t.active ? "Aktif" : "Pasif";

            html += `<div>
                <span>Masa **${t.number}**</span>
                <span class="${statusClass} active-status">${statusText}</span>
                <div>
                    <button onclick="setStatus(${t.number}, true)" ${t.active ? 'disabled' : ''}>Aktif Yap</button>
                    <button onclick="setStatus(${t.number}, false)" ${!t.active ? 'disabled' : ''}>Pasif Yap</button>
                </div>
            </div>`;
        });
        document.getElementById("list").innerHTML = html;
    }

    async function addTable() {
        const numInput = document.getElementById("num");
        const tableNumber = parseInt(numInput.value);

        if (isNaN(tableNumber) || tableNumber <= 0) {
            alert("Lütfen geçerli bir masa numarası girin.");
            return;
        }

        await fetch("/admin/tables", {
            method: "POST",
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({
                number: tableNumber,
                active: true // Yeni eklenen masa varsayılan olarak aktif başlar
            })
        });

        numInput.value = ''; // Input alanını temizle
        await load();
    }

    async function setStatus(num, active) {
        await fetch(`/admin/tables/${num}?active=${active}`, {
            method: "PUT"
        });
        await load();
    }

    // Sayfa yüklendiğinde listeyi çağır
    load();
</script>

</body>
</html>